---
title: 对象存储服务OSS
date: 2020-06-01 13:57:35
tags:
- OSS
- Bucket
- Object
- Region
- Endpoint
- AcessKey
categories:
- 对象存储OSS
---
#### 一、存储类型
OSS 提供标准、低频访问、归档三种存储类型，全面覆盖从热到冷的各种数据存储场景。其中标准存储类型提供高可靠、高可用、高性能的对象存储服务，能够支持频繁的数据访问；低频访问存储类型适合长期保存不经常访问的数据（平均每月访问频率 1 到 2 次），存储单价低于标准类型；归档存储类型适合需要长期保存（建议半年以上）的归档数据，在三种存储类型中单价最低。
<!--more-->
#### 二、存储空间（Bucket）
存储空间是您用于存储对象（Object）的容器，所有的对象都必须隶属于某个存储空间。您可以设置和修改存储空间属性用来控制地域、访问权限、生命周期等，这些属性设置直接作用于该存储空间内所有对象，因此您可以通过灵活创建不同的存储空间来完成不同的管理功能。

#### 三、对象/文件（Object）
对象是 OSS 存储数据的基本单元，也被称为 OSS 的文件。对象由元信息（Object Meta）、用户数据（Data）和文件名（Key）组成。对象由存储空间内部唯一的 Key 来标识。对象元信息是一组键值对，表示了对象的一些属性，比如最后修改时间、大小等信息，同时您也可以在元信息中存储一些自定义的信息。

#### 四、地域（Region）
地域表示 OSS 的数据中心所在物理位置。您可以根据费用、请求来源等综合选择数据存储的地域。

#### 五、访问域名（Endpoint）
Endpoint 表示 OSS 对外服务的访问域名。OSS 以 HTTP RESTful API 的形式对外提供服务，当访问不同地域的时候，需要不同的域名。通过内网和外网访问同一个地域所需要的域名也是不同的。

#### 六、访问密钥（AccessKey）
AccessKey，简称 AK，指的是访问身份验证中用到的 AccessKeyId 和 AccessKeySecret。OSS 通过使用 AccessKeyId 和 AccessKeySecret 对称加密的方法来验证某个请求的发送者身份。AccessKeyId 用于标识用户，AccessKeySecret 是用户用于加密签名字符串和 OSS 用来验证签名字符串的密钥，其中 AccessKeySecret 必须保密。

#### 七、费用
阿里OSS按实际使用容量收费

#### 八、上传方式
##### 1.基础上传
在一个会话上传中完成全部数据上传，同名文件上传会覆盖现有文件
##### 2.分片上传
将整个文件切分为多个分片独立上传，全部上传完成后，将分片合并成一个文件，适合大文件或弱网环境下的上传
##### 3.追加上传
文件可以追加到文件末尾，有效支持媒体数据的实时写入，如监控、视频直播等
#### 九、其他功能
白名单、防盗链、主子账号，提供用户级别的资源隔离机制，支持跨区域复制

缩略、剪裁、水印、缩放，音频视频转码，可搭配CDN

#### 十、优点
##### 1.可靠性
服务设计可用性不低于99.99%。  
规模自动扩展，不影响对外服务。  
数据设计持久性不低于99.999999999%。  
数据自动多重冗余备份。

###### 自建服务器：
受限于硬件可靠性，易出问题，一旦出现磁盘坏道，容易出现不可逆转的数据丢失。  
人工数据恢复困难、耗时、耗力。

##### 2.安全
提供企业级多层次安全防护。  
多用户资源隔离机制，支持异地容灾机制。  
提供多种鉴权和授权机制及白名单、防盗链、主子账号功能。

###### 自建服务器
需要另外购买清洗和黑洞设备。  
需要单独实现安全机制。

##### 3.成本
多线BGP骨干网络，无带宽限制，上行流量免费。  
无需运维人员与托管费用，0成本运维。

###### 自建服务器
存储受硬盘容量限制，需人工扩容。  
单线或双线接入速度慢，有带宽限制，峰值时期需人工扩容。  
需专人运维，成本高。

##### 4.数据处理能力
提供图片处理、音视频转码、内容加速分发、鉴黄服务、归档服务等多种数据增值服务，并不断丰富中。

###### 自建服务器
需要额外采购，单独部署。

##### 其他优势
###### 方便、快捷的使用方式
提供标准的RESTful API接口、丰富的SDK包、客户端工具、控制台。您可以像使用文件一样方便地上传、下载、检索、管理用于Web网站或者移动应用的海量数据。  

不限文件数量和大小。您可以根据所需存储量无限扩展存储空间，解决了传统硬件存储扩容问题。  
支持流式写入和读出。特别适合视频等大文件的边写边读业务场景。  

支持数据生命周期管理。您可以通过设置生命周期规则，将到期数据批量删除或者转储为更低成本的低频访问型存储或归档型存储。
###### 强大、灵活的安全机制
灵活的鉴权，授权机制。提供STS和URL鉴权和授权机制，以及白名单、防盗链、主子账号功能。

提供用户级别资源隔离机制和多集群同步机制（可选）。
###### 数据冗余机制
OSS 采用数据冗余存储机制，将每个对象的不同冗余存储在同一个区域内多个设施的多个设备上，确保硬件失效时的数据可靠性和可用性。

OSS Object 操作具有强一致性，用户一旦收到了上传/复制成功的响应，则该上传的 Object 就已经立即可读，且数据已经冗余写入到多个设备中。   

OSS 会通过计算网络流量包的校验和，验证数据包在客户端和服务端之间传输中是否出错，保证数据完整传输。  

OSS 的冗余存储机制，可支持两个存储设施并发损坏时，仍维持数据不丢失。  

当数据存入 OSS 后，OSS 会检测和修复丢失的冗余，确保数据可靠性和可用性。

OSS 会周期性地通过校验等方式验证数据的完整性，及时发现因硬件失效等原因造成的数据损坏。当检测到数据有部分损坏或丢失时，OSS 会利用冗余的数据，进行重建并修复损坏数据。
###### 丰富、强大的增值服务
图片处理：支持jpg、png、bmp、gif、webp、tiff等多种图片格式的转换，以及缩略图、剪裁、水印、缩放等多种操作。
音视频转码：提供高质量、高速并行的音视频转码能力，让您的音视频文件轻松应对各种终端设备。
内容加速分发：OSS作为源站，搭配CDN进行加速分发，具有稳定、无回源带宽限制、性价比高、一键配置的特点。


#### 十一、使用场景
OSS可用于图片、音视频、日志等海量文件的存储。各种终端设备、Web网站程序、移动应用可以直接向OSS写入或读取数据。OSS支持流式写入和文件写入两种方式。

#### 十二、计费方式
##### 1.按量计费
按实际使用量*单价的方式计费，每小时统计前一小时的实际用量并从账户余额中扣除实际消费金额。
##### 2.包年包月
预先购买指定资源包，之后使用资源时，扣除相应的额度。目前仅提供标准型存储包、归档型存储包、下行流量包、 回源流量包。

资源包使用无限制，超出资源包额度的部分采用按量付费的方式。

#### 十三、使用OSS
创建一个或者多个存储空间，向每个存储空间中添加一个或多个文件。

通过获取已上传文件的地址进行文件的分享和下载。

通过修改存储空间或文件的读写权限（ACL）来设置访问权限。

通过阿里云管理控制台、各种便捷工具、以及丰富的 SDK 包执行基本和高级 OSS 操作。

#### 十四、接入OSS
##### 1.临时凭证授权的上传
客户端向应用服务器发出上传文件到OSS的请求。  

应用服务器向STS服务器请求一次，获取临时凭证。

应用服务器回复客户端，将临时凭证返回给客户端。

客户端获取上传到OSS的授权（STS的AccessKey以及Token），调用OSS提供的移动端SDK上传。

客户端成功上传数据到OSS。如果没有设置回调，则流程结束。如果设置了回调功能，OSS会调用相关的接口。

###### 注意
客户端不需要每次都向应用服务器请求授权，在第一次授权完成之后可以缓存STS返回的临时凭证直到超过失效时间。

STS提供了强大的权限控制功能，可以将客户端的访问权限限制到Object级别，从而实现不同客户端在OSS端上传的Object的完全隔离，极大提高了安全性。

##### 2.签名URL授权的上传和表单上传
客户端向应用服务器发出上传文件到OSS的请求。  

应用服务器回复客户端，将上传凭证（签名URL或者表单）返回给客户端。  

客户端获取上传到OSS的授权（签名URL或者表单），调用OSS提供的移动端SDK上传或者直接表单上传。  

客户端成功上传数据到OSS。如果没有设置回调，则流程结束。如果设置了回调功能，OSS会调用相关的接口。

##### 3.临时凭证授权的下载
跟临时凭证授权的上传过程类似：

客户端向应用服务器发出下载OSS文件的请求。

应用服务器向STS服务器请求一次，获取临时凭证。

应用服务器回复客户端，将临时凭证返回给客户端。

客户端获取下载OSS文件的授权（STS的AccessKey以及Token），调用OSS提供的移动端SDK下载。

客户端成功从OSS下载文件。
##### 4.签名URL授权的下载
跟签名URL授权的上传类似：

客户端向应用服务器发出下载OSS文件的请求。

应用服务器回复客户端，将签名URL返回给客户端。

客户端获取下载OSS文件的授权（签名URL），调用OSS提供的移动端SDK下载。

客户端成功从OSS下载文件。

#### 十五、请求流程
##### 匿名请求流程
1.用户的请求被发送到OSS的HTTP服务器上。

2.OSS根据URL解析出Bucket和Object。

3.OSS检查Object是否设置了ACL。

如果没有设置ACL，那么继续4。

如果设置了ACL，则判断Object的ACL是否允许匿名用户访问。 

   允许则跳到5。
   
   不允许则拒绝请求，请求结束。
   
4.OSS判断Bucket的ACL是否允许匿名用户访问。

   允许则继续5。 
   
   不允许则返回，请求结束。
   
5.权限验证通过，返回Object的内容给用户。

##### 带身份验证的请求流程
1.用户的请求被发送到OSS的HTTP服务器上。

2.OSS根据URL解析出Bucket和Object。

3.OSS根据请求的OSS的AccessKeyId获取请求者的相关身份信息，进行身份鉴权。

如果未获取成功，则返回，请求结束。

如果获取成功，但请求者不被允许访问此资源，则返回，请求结束。

如果获取成功，但OSS端根据请求的HTTP参数计算的签名和请求发送的签名字符串不匹配，则返回，请求结束。

如果身份鉴权成功，那么继续4。

4.OSS检查Object是否设置了ACL。

如果Object没有设置ACL，那么继续5。

如果Object设置了ACL，OSS判断Object的ACL是否允许此用户访问。

允许则跳到6。

不允许则拒绝请求，请求结束。

5.OSS判断Bucket的ACL是否允许此用户访问。

允许则继续6。

不允许则返回，请求结束。

6.权限验证通过，返回Object的内容给用户。

#### 十六、AccessKey 类型
1.阿里云账号 AK

2.RAM 子账号 AK

3.STS 账号 AK

#### 十七、签名
##### 1.在Header中包含签名

用户可以在HTTP请求中增加 Authorization 的Header来包含签名（Signature）信息，表明这个消息已被授权。

##### 2.在URL中包含签名
除了使用Authorization Header，用户还可以在URL中加入签名信息，这样用户就可以把该URL转给第三方实现授权访问。
```
http://oss-example.oss-cn-hangzhou.aliyuncs.com/oss-api.pdf?OSSAccessKeyId=nz2pc56s936**9l
&Expires=1141889120&Signature=vjbyPxybdZaNmGa%2ByT272YEAiv4%3D
```
